---
- hosts: aws-web
  remote_user: ubuntu
  tasks:
  - name: stop application
    shell: docker-compose -f /home/ubuntu/web/docker-compose.yml down || /bin/true

  - name: clean
    file:
      path: "{{ item }}"
      state: absent
    loop:
      - /home/ubuntu/web

  - name: clone repository
    git:
      repo: 'https://github.com/mesinger/mesi-io-frontend.git'
      dest: /home/ubuntu/web
    
  - name: docker build
    shell: docker build -t mesi/web /home/ubuntu/web

  - name: docker up
    shell: docker-compose -f /home/ubuntu/web/docker-compose.yml up -d
